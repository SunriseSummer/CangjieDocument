# 基本操作符

仓颉编程语言提供了丰富的操作符来执行数学运算、逻辑判断和数据处理。为了提高代码的安全性和可读性，仓颉在操作符的设计上做了一些针对性的改进。

## 1. 赋值操作符

### 基本赋值
使用 `=` 将右侧的值赋给左侧的变量。
- **类型安全**: 右侧值的类型必须兼容左侧变量的类型。
- **返回 Unit**: 赋值表达式的返回值类型是 `Unit`，值为 `()`。这意味着你不能连续赋值（如 `a = b = 1`），也不能在 `if` 条件中误用赋值（如 `if (a = 1)` 会导致类型不匹配错误）。

<!-- compile.error -->
```cangjie
var a = 1
var b = 2
// a = b = 3 // ❌ 错误：不支持链式赋值
// if (a = 1) {} // ❌ 错误：if 条件必须是 Bool 类型，而赋值表达式是 Unit
```

### 多重赋值
仓颉支持使用元组进行多重赋值，方便同时更新多个变量的值。
- 使用 `_` 可以忽略不需要的值。

<!-- verify -->
```cangjie
main() {
    var a = 1
    var b = 2

    (a, b) = (b, a) // 交换 a 和 b 的值
    println("a=${a}, b=${b}") // a=2, b=1

    let (x, _, z) = (10, 20, 30) // 忽略中间的值
    println("x=${x}, z=${z}")
}
```

### 复合赋值
仓颉提供了一系列复合赋值操作符，如 `+=`, `-=`, `*=`, `&&=` 等。
- 表达式 `a += b` 等价于 `a = a + b`。
- 求值顺序：先计算左值，再计算右值，最后执行运算并赋值。

```cangjie
var n = 10
n += 5 // n = 15
```

## 2. 算术操作符

支持标准的算术运算：`+` (加), `-` (减), `*` (乘), `/` (除), `%` (取余), `**` (幂)。

> **⚠️ 注意**:
> - 整数除法向 0 取整 (e.g., `7 / 3 == 2`, `-7 / 3 == -2`).
> - 运算结果溢出会导致运行时异常（除非编译器能静态检测出）。
> - `+` 也可用于字符串拼接。

<!-- verify -->
```cangjie
main() {
    println(2 + 3)      // 5
    println(2 ** 3)     // 8 (幂运算)
    println("Hello" + " World") // 字符串拼接
}
```

## 3. 关系操作符

用于比较两个值，结果为 `Bool` 类型 (`true` 或 `false`)。
- 包括: `==`, `!=`, `<`, `>`, `<=`, `>=`。
- 两个元组可以进行相等性比较，前提是它们长度相同且对应位置的元素支持比较。

<!-- verify -->
```cangjie
main() {
    println(1 < 2)        // true
    println((1, "a") == (1, "a")) // true
}
```

## 4. 逻辑操作符

用于组合布尔条件。支持**短路求值**。

- `!` (非): 取反。
- `&&` (与): 两者都为真才为真。如果左侧为 `false`，则不计算右侧。
- `||` (或): 只要有一个为真即为真。如果左侧为 `true`，则不计算右侧。

<!-- verify -->
```cangjie
main() {
    let a = true
    let b = false
    println(a && b) // false
    println(a || b) // true
}
```

## 5. 位运算操作符

用于对整数进行二进制位操作。
- `!` (按位取反)
- `&` (按位与), `|` (按位或), `^` (按位异或)
- `<<` (左移), `>>` (右移)

> **注意**: 移位操作的右操作数不能为负数，且不能超过类型的位宽，否则会抛出异常。

```cangjie
let x = 0b1010 // 10
let y = x << 1 // 20 (0b10100)
```

## 6. 自增与自减

仓颉仅支持**后缀**形式的自增 (`++`) 和自减 (`--`)。
- **返回 Unit**: 表达式 `i++` 的值是 `()`，不是 `i` 的旧值或新值。因此不能写 `let a = i++`。
- 它们是 `i += 1` 和 `i -= 1` 的语法糖。

<!-- verify -->
```cangjie
main() {
    var i = 0
    i++
    println(i) // 1
}
```

## 7. 其他操作符

- **Coalescing (`??`)**: 空值合并操作符，用于 `Option` 类型。如果左侧是 `Some`，取其值；如果是 `None`，取右侧的默认值。
- **区间 (`..`, `..=`)**: 用于创建区间对象。
    - `0..5`: 包含 0, 1, 2, 3, 4 (左闭右开)。
    - `0..=5`: 包含 0, 1, 2, 3, 4, 5 (左闭右闭)。

<!-- verify -->
```cangjie
main() {
    let opt: Option<Int64> = None
    let val = opt ?? 0 // 如果 opt 是 None，则 val 为 0
    println(val)
}
```

更多详细规则请参考[附录-操作符](../Appendix/operator.md)。
